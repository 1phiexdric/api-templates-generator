import { MongoClient } from "mongodb";
import "dotenv/config";

// DbClient maneja la conexión con la base de datos MongoDB usando el driver nativo.
class DbClient {
    db;
    client;

    constructor() {
        // Construye la cadena de conexión y establece la conexión al instanciar.
        const connectionString = `mongodb://${process.env.DB_USER}:${process.env.DB_PASSWORD}@${process.env.DB_HOST}:${process.env.DB_PORT}`;
        this.client = new MongoClient(connectionString);
        this.connect();
    }

    // connect establece la conexión con la base de datos.
    async connect() {
        try {
            await this.client.connect();
            this.db = this.client.db(process.env.DB_NAME);
            console.log("Conectado a la base de datos");
        } catch (e) {
            console.error("Error al conectar a la base de datos:", e);
        }
    }

    // close cierra la conexión con la base de datos.
    async close() {
        if (this.client) {
            await this.client.close();
            console.log('Conexión a MongoDB cerrada.');
        }
    }
}

// Exporta una única instancia de DbClient.
export default new DbClient();

